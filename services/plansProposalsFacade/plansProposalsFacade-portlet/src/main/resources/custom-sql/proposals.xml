<?xml version="1.0"?>

<!--
  ~ Copyright (c) 2010. M.I.T. All Rights Reserved
  ~ Licensed under the MIT license. Please see http://www.opensource.org/licenses/mit-license.php
  ~ or the license.txt file included in this distribution for the full text of the license.
  -->

<custom-sql>
    <sql id="com.ext.portlet.service.persistence.ProposalRatingFinder.findByProposalIdJudgeTypeContestPhaseId">
		<![CDATA[
			SELECT
                pr.*
            FROM
                xcolab_ProposalRating pr,
                xcolab_ProposalRatingValue prv,
                xcolab_ProposalRatingType prt
            WHERE
                pr.proposalId = ? AND
                pr.ratingValueId = prv.id_ AND
                prv.ratingTypeId = prt.id_ AND
                prt.judgeType = ? AND
                pr.contestPhaseId = ?
            ORDER BY userId ASC
		]]>
	</sql>

    <sql id="com.ext.portlet.service.persistence.ProposalRatingFinder.findByProposalIdJudgeTypeJudgeIdContestPhaseId">
        <![CDATA[
			SELECT
                pr.*
            FROM
                xcolab_ProposalRating pr,
                xcolab_ProposalRatingValue prv,
                xcolab_ProposalRatingType prt
            WHERE
                pr.proposalId = ? AND
                pr.ratingValueId = prv.id_ AND
                prv.ratingTypeId = prt.id_ AND
                prt.judgeType = ? AND
                pr.userId = ? AND
                pr.contestPhaseId = ?
            ORDER BY userId ASC
		]]>
    </sql>
    <sql id="com.ext.portlet.service.persistence.ProposalFinder.findByContestPhaseIdAndVisible">
        <![CDATA[
			SELECT
			    p.*
			FROM xcolab_Proposal p
            JOIN xcolab_Proposal2Phase p2p on p.proposalId = p2p.proposalId
            WHERE
                p2p.contestPhaseId = ? AND
                p.visible = true AND
                p.proposalId not in
                    (SELECT
                        proposalId
                    FROM xcolab_ProposalContestPhaseAttribute
                    WHERE
                        contestPhaseId = ? AND
                        name = 'VISIBLE' AND
                        numericValue = 0
                    )
            ORDER BY p.proposalId ASC
		]]>
    </sql>
    <sql id="com.ext.portlet.service.persistence.ProposalAttributeFinderImpl.findByProposalIdVersionGreaterThanVersionWhenCreatedLessThanNameLikeImpact">
        <![CDATA[
			SELECT
                pa.*
            FROM
                xcolab_ProposalAttribute pa
            WHERE
                pa.proposalId = ? AND
                pa.version >= ? AND
                pa.versionWhenCreated <= ? AND
                pa.name LIKE "IMPACT_%"
		]]>
    </sql>
</custom-sql>